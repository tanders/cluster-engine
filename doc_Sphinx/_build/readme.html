
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cluster Engine &#8212; cluster-engine 0.158 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.158',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cluster Engine API" href="cluster-engine-API.html" />
    <link rel="prev" title="Welcome to cluster-engine’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="cluster-engine">
<h1>Cluster Engine<a class="headerlink" href="#cluster-engine" title="Permalink to this headline">¶</a></h1>
<p>Cluster Engine is a constraint solver for solving polyphonic constraint
satisfaction problems where both the pitch and the rhythmic structure
can be restricted by an arbitrary number of constraints (rules), and the
solver then searches for a solution that is consistent with all
constraints. This library supports user-defined rules, and highly
flexible ways to control which aspects of the resulting score are
controlled by certain rules. For example, you can independently control
with compositional rules the melody and harmony of the music you
generate.</p>
<p>Cluster Engine is the successor of PWMC (Sandred, 2010). It was
originally developed as a library for the free composition environment
<a class="reference external" href="http://www2.siba.fi/pwgl">PWGL</a>.</p>
<p>The present version still runs in PWGL, but also on plain Common Lisp in
order to make it useable within <a class="reference external" href="http://opusmodus.com">Opusmodus</a> and
– via a <a class="reference external" href="http://www.sbcl.org">SBCL</a> interface – in the music and
media programming environment
<a class="reference external" href="https://cycling74.com/products/max">Max</a> (Vincenot, 2017).</p>
<p>Cluster Engine has been successfully tested on PWGL (based on
Lispworks), SBCL and Opusmodus (<a class="reference external" href="http://ccl.clozure.com">Clozure
CL</a>).</p>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>Sandred, Ö. (2010) PWMC, a Constraint-Solving System for Generating
Music Scores. <em>Computer Music Journal</em>. 34(2), 8–24.</p>
<p>Vincenot, J. (2017) LISP in Max: Exploratory Computer-Aided Composition
in Real-Time. <em>ICMC 2017</em>.</p>
</div>
</div>
<div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pwgl">
<h2>PWGL<a class="headerlink" href="#pwgl" title="Permalink to this headline">¶</a></h2>
<p>These instructions explain how to install Cluster Engine for PWGL.
First, download the library with the download link at
<a class="reference external" href="http://github.com/tanders/cluster-engine">http://github.com/tanders/cluster-engine</a> and unzip the folder. Then,
make sure the folder is named <code class="docutils literal"><span class="pre">cluster-engine</span></code> (remove the <code class="docutils literal"><span class="pre">master</span></code>
part of the folder name). Finally, move this folder inside the PWGL user
library folder (<code class="docutils literal"><span class="pre">~/PWGL-User/User-library/</span></code>).</p>
</div>
<div class="section" id="common-lisp">
<h2>Common Lisp<a class="headerlink" href="#common-lisp" title="Permalink to this headline">¶</a></h2>
<p>This section explain how to install Cluster Engine as a plain Common
Lisp library (e.g., to be used by Opusmodus). We are using git for the
installation. Even though this is a bit more involved at first, it
allows for convenient updates later, and you can even contribute to the
development.</p>
<p>Install <a class="reference external" href="https://git-scm.com">git</a> (if you have not done already).
Also, you should register at <a class="reference external" href="https://github.com">GitHub</a>.</p>
<p>Download the present software with git into a directory where
<a class="reference external" href="https://common-lisp.net/project/asdf/">ASDF</a> can find the software,
e.g.,
<a class="reference external" href="https://common-lisp.net/project/asdf/asdf/Quick-start-summary.html#Quick-start-summary">~/common-lisp</a>.
For example, on UNIX incl. OS X you can enter the following commands at
the command line (after you created the directory <code class="docutils literal"><span class="pre">~/common-lisp/</span></code>).
Note that <code class="docutils literal"><span class="pre">$</span></code> is the terminal prompt here, you do not need to enter
that :)</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ~/common-lisp
<span class="nv">$ </span>git clone https://github.com/tanders/cluster-engine.git
</pre></div>
</div>
<p>You will be asked for your GitHub username and password.</p>
</div>
<div class="section" id="updating-your-software">
<h2>Updating your software<a class="headerlink" href="#updating-your-software" title="Permalink to this headline">¶</a></h2>
<p>If there are
<a class="reference external" href="https://github.com/tanders/cluster-engine/commits/master">changes</a>,
you can update your software later at the terminal in the following way.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd</span> ~/common-lisp/cluster-engine
<span class="nv">$ </span>git pull
</pre></div>
</div>
</div>
</div>
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>PWGL<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>If you use Cluster Engine in PWGL, you load the library in PWGL with
File &gt; Load Library…</p>
<p>The library comes with a tutorial, which you find under Help &gt; PWGL
Tutorial… In the tutorial browser that opens then move to Library
Tutorials &gt; cluster-engine. The tutorial consists of a collection of
live patches with comments and documentation slides.</p>
</div>
<div class="section" id="id2">
<h2>Common Lisp<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Cluster Engine is an <a class="reference external" href="https://common-lisp.net/project/asdf/">ASDF</a>
system (ASDF is the de facto standard for building Common Lisp
software), and you can load it into your Lisp compiler as follows.</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span class="p">(</span><span class="nb">require</span> <span class="ss">:cluster-engine</span><span class="p">)</span>
</pre></div>
</div>
<p>The library should now be loaded, and you can solve musical constraint
satisfaction problems. The first example below is an “empty” problem
without any constraints yet. The function <code class="docutils literal"><span class="pre">clusterengine</span></code> is the
constraint solver. Its first three arguments specify the number of
variables (quasi notes) per voice (<code class="docutils literal"><span class="pre">10</span></code> in this example), whether or
not to randomise the solution (<code class="docutils literal"><span class="pre">T</span></code>) and whether to use additional
debugging features (<code class="docutils literal"><span class="pre">nil</span></code>). After a list of constraints (empty in this
first example) the function expects specifications for various domains.
These specifications support a mini language for flexibility, the
specifications below are very simple. Only a single time signature is
allowed (all bars are in 3/4 time); the single voice can consist of
quarter notes and eighth notes; and possible pitches are middle C and C#
(MIDI note numbers 60 and 61).</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span class="p">(</span><span class="nv">ce::clusterengine</span>
 <span class="mi">10</span> <span class="no">t</span> <span class="no">nil</span>           <span class="c1">; settings</span>
 <span class="no">nil</span>                <span class="c1">; no constraints</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>           <span class="c1">; metric domain</span>
 <span class="c1">;; domain of rhythmic values and pitches for one voice</span>
 <span class="o">&#39;</span><span class="p">(((</span><span class="m">1/4</span><span class="p">)</span> <span class="p">(</span><span class="m">1/8</span><span class="p">))</span>
   <span class="p">((</span><span class="mi">60</span><span class="p">)</span> <span class="p">(</span><span class="mi">61</span><span class="p">))))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">clusterengine</span></code> outputs a declaration of the sequences of time
signatures, rhythmic values and pitches for each voice.</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span class="p">(</span><span class="c1">; rhythmic values of voice 1</span>
 <span class="p">(</span><span class="m">1/4</span> <span class="m">1/8</span> <span class="m">1/8</span> <span class="m">1/8</span> <span class="m">1/4</span> <span class="m">1/8</span> <span class="m">1/8</span> <span class="m">1/8</span> <span class="m">1/8</span> <span class="m">1/8</span><span class="p">)</span>
 <span class="c1">; pitches</span>
 <span class="p">(</span><span class="mi">60</span> <span class="mi">61</span> <span class="mi">60</span> <span class="mi">61</span> <span class="mi">61</span> <span class="mi">60</span> <span class="mi">60</span> <span class="mi">60</span> <span class="mi">60</span> <span class="mi">61</span><span class="p">)</span>
 <span class="c1">; time signatures</span>
 <span class="p">((</span><span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
<p>The output is automatically translated into a notated score in PWGL, and
can be translated into an OpusModus score with the function
<code class="docutils literal"><span class="pre">cluster-engine-score</span></code>, which in turn can be translated into a notated
score with <code class="docutils literal"><span class="pre">preview-score</span></code> – both functions provided by the library
<a class="reference external" href="https://github.com/tanders/tot">tot</a>.</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span class="p">(</span><span class="ss">:|1|</span> <span class="p">((</span><span class="nv">q</span> <span class="nv">c4</span> <span class="nv">e</span> <span class="nv">cs4</span> <span class="nv">c4</span> <span class="nv">cs4</span> <span class="nv">cs4</span> <span class="nv">tie</span><span class="p">)</span> <span class="p">(</span><span class="nv">e</span> <span class="nv">cs4</span> <span class="nv">c4</span> <span class="nv">c4</span> <span class="nv">c4</span> <span class="nv">c4</span> <span class="nv">cs4</span><span class="p">)))</span>
</pre></div>
</div>
<p>The above constraint problem does not include any musical rules. Without
a detailed discussion, in the following a polyphonic example with a few
rules is shown (example 8a translated from the PWGL tutorial into plain
Common Lisp). Here, the first rule forces both voices to create 12-tone
rows. Rule 2 constrains all harmonic intervals between both voices to
consonant intervals or 3, 4, 7, 8 or 9 semitones. Finally, the last rule
forbids any voice crossings. A possible result is shown below the code.</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span class="p">(</span><span class="nv">ce::clusterengine</span>
 <span class="mi">12</span> <span class="no">t</span> <span class="no">nil</span>
 <span class="p">(</span><span class="nb">append</span>
  <span class="c1">;; rule 1</span>
  <span class="p">(</span><span class="nv">ce::r-pitches-one-voice</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">member</span> <span class="p">(</span><span class="nb">mod</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">last</span> <span class="nv">x</span><span class="p">))</span> <span class="mi">12</span><span class="p">)</span>
                        <span class="p">(</span><span class="nb">mapcar</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">mod</span> <span class="nv">a</span> <span class="mi">12</span><span class="p">))</span> <span class="p">(</span><span class="nb">butlast</span> <span class="nv">x</span><span class="p">)))))</span>
               <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="ss">:all-pitches</span><span class="p">)</span>
  <span class="c1">;; rule 2</span>
  <span class="p">(</span><span class="nv">ce::r-pitch-pitch</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
             <span class="p">(</span><span class="nb">member</span> <span class="p">(</span><span class="nb">mod</span> <span class="p">(</span><span class="nv">ce::apply-minus</span> <span class="nv">x</span><span class="p">)</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">3</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span><span class="p">)))</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ss">:all</span> <span class="ss">:no_grace</span> <span class="ss">:pitch</span><span class="p">)</span>
  <span class="c1">;; rule 3</span>
  <span class="p">(</span><span class="nv">ce::R-pitch-pitch</span> <span class="nf">#&#39;</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">&gt;=</span> <span class="p">(</span><span class="nb">first</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">second</span> <span class="nv">x</span><span class="p">))</span> <span class="p">)</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ss">:all</span> <span class="ss">:no_grace</span> <span class="ss">:pitch</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">((</span><span class="mi">4</span> <span class="mi">4</span><span class="p">))</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="c1">;; domains of rhythmic values and pitches of voice 1</span>
   <span class="p">((</span><span class="m">1/4</span><span class="p">))</span>
   <span class="p">((</span><span class="mi">60</span><span class="p">)</span> <span class="p">(</span><span class="mi">61</span><span class="p">)</span> <span class="p">(</span><span class="mi">62</span><span class="p">)</span> <span class="p">(</span><span class="mi">63</span><span class="p">)</span> <span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="p">(</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="mi">66</span><span class="p">)</span> <span class="p">(</span><span class="mi">67</span><span class="p">)</span> <span class="p">(</span><span class="mi">68</span><span class="p">)</span> <span class="p">(</span><span class="mi">69</span><span class="p">)</span> <span class="p">(</span><span class="mi">70</span><span class="p">)</span> <span class="p">(</span><span class="mi">71</span><span class="p">)</span> <span class="p">(</span><span class="mi">72</span><span class="p">)</span> <span class="p">(</span><span class="mi">73</span><span class="p">)</span> <span class="p">(</span><span class="mi">74</span><span class="p">)</span> <span class="p">(</span><span class="mi">75</span><span class="p">)</span> <span class="p">(</span><span class="mi">76</span><span class="p">)</span> <span class="p">(</span><span class="mi">77</span><span class="p">)</span> <span class="p">(</span><span class="mi">78</span><span class="p">)</span> <span class="p">(</span><span class="mi">79</span><span class="p">))</span>
   <span class="c1">;; domains of rhythmic values and pitches of voice 2</span>
   <span class="p">((</span><span class="m">1/4</span><span class="p">))</span>
   <span class="p">((</span><span class="mi">60</span><span class="p">)</span> <span class="p">(</span><span class="mi">61</span><span class="p">)</span> <span class="p">(</span><span class="mi">62</span><span class="p">)</span> <span class="p">(</span><span class="mi">63</span><span class="p">)</span> <span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="p">(</span><span class="mi">65</span><span class="p">)</span> <span class="p">(</span><span class="mi">66</span><span class="p">)</span> <span class="p">(</span><span class="mi">67</span><span class="p">)</span> <span class="p">(</span><span class="mi">68</span><span class="p">)</span> <span class="p">(</span><span class="mi">69</span><span class="p">)</span> <span class="p">(</span><span class="mi">70</span><span class="p">)</span> <span class="p">(</span><span class="mi">71</span><span class="p">)</span> <span class="p">(</span><span class="mi">72</span><span class="p">)</span> <span class="p">(</span><span class="mi">73</span><span class="p">)</span> <span class="p">(</span><span class="mi">74</span><span class="p">)</span> <span class="p">(</span><span class="mi">75</span><span class="p">)</span> <span class="p">(</span><span class="mi">76</span><span class="p">)</span> <span class="p">(</span><span class="mi">77</span><span class="p">)</span> <span class="p">(</span><span class="mi">78</span><span class="p">)</span> <span class="p">(</span><span class="mi">79</span><span class="p">))))</span>
</pre></div>
</div>
<p><img alt="image0" src="file:graphics/polyphonic-solution.jpg" /></p>
<p>For further information refer to the PWGL tutorial for now. Pretty much
all PWGL boxes have their equivalent Common Lisp function/macro with the
same arguments. An exception is the function <code class="docutils literal"><span class="pre">clusterengine</span></code> itself,
where domains of rhythmic values and pitches are defined in Common Lisp
as shown above.</p>
</div>
<div class="section" id="cluster-rules">
<h2>Cluster Rules<a class="headerlink" href="#cluster-rules" title="Permalink to this headline">¶</a></h2>
<p>The Common Lisp library <a class="reference external" href="https://github.com/tanders/cluster-rules">Cluster
Rules</a> extends Cluster
Engine by a collection of predefined musical constraints and that way
makes it more easy to use. The equivalent PWGL library is <a class="reference external" href="https://github.com/tanders/pwgl-cluster-rules">PWGL Cluster
Rules</a>.</p>
</div>
<div class="section" id="temporary-test">
<h2>Temporary Test<a class="headerlink" href="#temporary-test" title="Permalink to this headline">¶</a></h2>
<p>Some more Common Lisp code block tests.</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span class="p">(</span><span class="nb">defun</span> <span class="nv">one+</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>And another test showing captions.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">This is a test caption for a simple definition</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-common-lisp"><div class="highlight"><pre> <span class="p">(</span><span class="nb">defun</span> <span class="nv">one+</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">cluster-engine</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cluster Engine</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pwgl">PWGL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-lisp">Common Lisp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-your-software">Updating your software</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">PWGL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Common Lisp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-rules">Cluster Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#temporary-test">Temporary Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cluster-engine-API.html">Cluster Engine API</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lisp_API_test.html">Lisp API documentation test</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python_API_test.html">Python API documentation test</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to cluster-engine’s documentation!</a></li>
      <li>Next: <a href="cluster-engine-API.html" title="next chapter">Cluster Engine API</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Örjan Sandred.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/readme.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>